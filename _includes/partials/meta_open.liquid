<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/' | url }}assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ '/' | url }}assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ '/' | url }}assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="{{ '/' | url }}assets/images/favicons/site.webmanifest">
    <title>
      {% if title %}{{ title }} | {% endif %}Moby Dick; or The Whale, by Herman Melville
    </title>
    <link rel="stylesheet" href="{{ '/' | url }}assets/css/styles.css" />
    <script src="{{ '/' | url }}assets/js/vendor/widowadjust-min.js"></script>
    <script src="{{ '/' | url }}assets/js/vendor/fontfaceobserver.js"></script>

    <script type="text/javascript">
  		(function() {
  			document.documentElement.className += " wf-inactive"; 

        function cssPropertyValueSupported(prop, value) {
          var d = document.createElement('div');
          d.style[prop] = value;
          return d.style[prop] === value;
        }
        function vfSupported() {
          const vfCheckString = getComputedStyle(document.documentElement).getPropertyValue('--vf-support').trim();
          //console.log(vfCheckString);
          if (vfCheckString) {
            if (vfCheckString == 'true') {
              var vfCheck = true;
            } else {
              var vfCheck = false;
            }
            return vfCheck;
          }
        }

        var vfSupport = true;
        
        var vfSupport = vfSupported();
        // should return true if the browser supports variable fonts
				console.log('vfSupport: '+vfSupport);
        const vfJsCheck = "CSS" in window && "supports" in CSS && CSS.supports("(font-variation-settings: normal)");  
        console.log('vfJsCheck:');
        console.log(vfJsCheck);

  			// Optimization for Repeat Views
  			if( sessionStorage.foutFontsLoaded ) {
  				document.documentElement.classList.remove("wf-inactive");
  				document.documentElement.classList.add("wf-active");
  				return;
  			}
        
        if( vfSupport == true ) { // Check for variable fonts 
					var fontA = new FontFaceObserver('Literata Variable', {
						weight: 400,
						style: 'normal'
					});
					var fontB = new FontFaceObserver('Literata Variable', {
							weight: 400,
							style: 'italic'
						});
			
					Promise.all([fontA.load(), fontB.load()]).then(function () {
            document.documentElement.classList.remove("wf-inactive");
            document.documentElement.classList.add("wf-active");
          
    				// Optimization for Repeat Views
    				sessionStorage.foutFontsLoaded = true;
  				});
        } else { // Else check for static web fonts
					var fontA = new FontFaceObserver('Literata', {
							weight: 'normal',
							style: 'normal'
						});
					var fontB = new FontFaceObserver('Literata', {
							weight: 'normal',
							style: 'italic'
						});
          var fontC = new FontFaceObserver('Literata', {
							weight: 'bold',
							style: 'normal'
						});
					var fontD = new FontFaceObserver('Literata', {
							weight: 'bold',
							style: 'italic'
						});
					var fontE = new FontFaceObserver('Literata', {
							weight: '300',
							style: 'normal'
						});
					var fontF = new FontFaceObserver('Literata', {
							weight: '500',
							style: 'normal'
						});
					var fontG = new FontFaceObserver('Literata', {
							weight: '600',
							style: 'normal'
						});
					var fontH = new FontFaceObserver('Literata Caption', {
							weight: 'normal',
							style: 'normal'
						});
					var fontI = new FontFaceObserver('Literata Deck', {
							weight: '300',
							style: 'normal'
						});
					var fontJ = new FontFaceObserver('Literata Display', {
							weight: '300',
							style: 'normal'
						});
					var fontK = new FontFaceObserver('Literata Display', {
							weight: 'normal',
							style: 'normal'
						});
					var fontL = new FontFaceObserver('Literata Display', {
							weight: '900',
							style: 'normal'
						});

					Promise.all([fontA.load(), fontB.load(), fontC.load(), fontD.load(), fontE.load(), fontF.load(), fontG.load(), fontH.load(), fontI.load(), fontJ.load(), fontK.load(), fontL.load()]).then(function () {
            document.documentElement.classList.remove("wf-inactive");
            document.documentElement.classList.add("wf-active");
          
    				// Optimization for Repeat Views
    				sessionStorage.foutFontsLoaded = true;
    			});
        }
  		})();
  	</script>

  </head>
  <body>
    <header id="top" class="top-bar">
      <a href="#main_content" class="visually-hidden">Jump to main <span role="presentation">content</span></a>
      <div>
        <a href="{{ '/' | url }}" class="title-link">{{ metadata.title }}</a>
      </div>
      <nav class="toc">
        <a href="{{ '/' | url }}contents" class="toc-trigger">Table of Contents</a>
        {% include partials/toc.liquid %}
      </nav>
    </header>
    <main id="main_content">
        {% include partials/webfont_toggle.liquid %}
